import { useState, useEffect } from "react";

const TERMS = [
  { term:"Abacus",                          def:"A manual counting tool using beads slid along rods" },
  { term:"Abstraction",                     def:"Simplifying complex systems by hiding irrelevant details" },
  { term:"Algorithm",                       def:"A defined sequence of steps to solve a specific problem" },
  { term:"Applications Software",          def:"Programs designed to perform specific tasks for end users" },
  { term:"Argument",                        def:"A piece of data passed to a function when it is called" },
  { term:"Artificial Intelligence",        def:"Technology enabling machines to simulate human thinking" },
  { term:"Assembler",                       def:"A tool that converts assembly language into machine code" },
  { term:"Assembly Languages",             def:"Low-level languages using short symbolic codes (mnemonics)" },
  { term:"Batch Processing",               def:"Executing a group of tasks with no user interaction" },
  { term:"Big Data",                        def:"Extremely large datasets requiring special tools to analyze" },
  { term:"Binary Digits",                  def:"The base-2 number symbols (0 and 1) used in computing" },
  { term:"Bits",                            def:"The smallest unit of digital data: a single 0 or 1" },
  { term:"Bit-Mapped Display Screen",      def:"A display that forms images from a grid of tiny pixels" },
  { term:"Byte Code",                      def:"Intermediate code designed to run on a virtual machine" },
  { term:"Card Reader",                    def:"A device that reads data punched into cards" },
  { term:"Cathode Ray Tube (CRT) Screen",  def:"An older monitor using an electron beam to show images" },
  { term:"Central Processing Unit (CPU)",  def:"The main chip in a computer that executes all instructions" },
  { term:"Client",                          def:"A device or program that requests services from a server" },
  { term:"Client/Server Applications",     def:"Software split between a requesting client and responding server" },
  { term:"Cloud Computing",                def:"Using remote Internet servers to store and process data" },
  { term:"Compiler",                        def:"Translates an entire program from source code to machine code" },
  { term:"Computing Agent",               def:"A program that performs tasks autonomously on a user's behalf" },
  { term:"Concurrent Processing",          def:"Carrying out multiple tasks at the same time" },
  { term:"Data",                            def:"Raw, unprocessed facts and figures stored in a computer" },
  { term:"Data Science",                   def:"The field of analyzing large datasets to find insights" },
  { term:"Digital Cloud",                  def:"Remote Internet-based servers for storing and accessing data" },
  { term:"Executed",                        def:"When a program's instructions are carried out by the CPU" },
  { term:"File System",                    def:"Software that organizes files and folders on storage devices" },
  { term:"Graphical User Interface (GUI)", def:"A visual display using icons, windows, and menus" },
  { term:"Hardware",                        def:"The physical parts and components of a computer" },
  { term:"High-Level Programming Languages", def:"Languages written with syntax closer to natural English" },
  { term:"Hypermedia",                     def:"Linked content combining text, images, audio, and video" },
  { term:"Information Processing",         def:"The systematic collection, storage, and analysis of data" },
  { term:"Input",                           def:"Any data or commands entered into a computer system" },
  { term:"Input/Output Devices",           def:"Hardware peripherals used to enter or retrieve data" },
  { term:"Integrated Circuit",             def:"A set of electronic components built onto a single chip" },
  { term:"Internet of Things (IoT)",       def:"Everyday objects connected to the Internet to share data" },
  { term:"Interpreter",                    def:"A program that translates and runs code one line at a time" },
  { term:"Keypunch Machine",               def:"A device that enters data by punching holes into cards" },
  { term:"Loader",                          def:"A program that places executable code into memory to run" },
  { term:"Machine Code",                   def:"Binary instructions that a processor can directly execute" },
  { term:"Magnetic Storage Media",         def:"Storage devices that save data using magnetic fields" },
  { term:"Mainframe Computers",            def:"Large, high-performance computers for heavy data processing" },
  { term:"Memory",                          def:"Hardware that temporarily holds data for quick CPU access" },
  { term:"Microprocessor",                 def:"A small integrated chip that serves as a computer's CPU" },
  { term:"Moore's Law",                    def:"The observation that processor power doubles roughly every 2 years" },
  { term:"Networks",                        def:"Systems of connected computers that can exchange data" },
  { term:"Newline",                         def:"A special character that moves text to the next line" },
  { term:"Operating System",               def:"Software that manages a computer's hardware and resources" },
  { term:"Optical Storage Media",          def:"Devices that store data using laser-read light patterns" },
  { term:"Output",                          def:"Any data or results displayed or sent out by a computer" },
  { term:"Personal Digital Assistants (PDAs)", def:"Small handheld devices for scheduling and note-taking" },
  { term:"Ports",                           def:"Physical or logical connection points for data transfer" },
  { term:"Primary Memory",                 def:"Fast-access memory used directly by the CPU during processing" },
  { term:"Processor",                      def:"The hardware component that carries out program instructions" },
  { term:"Programs",                        def:"Ordered sets of instructions that direct a computer's actions" },
  { term:"Programming Languages",          def:"Formal rule-based systems used to write computer programs" },
  { term:"Program Libraries",              def:"Pre-written collections of reusable code for developers" },
  { term:"Python Shell",                   def:"An interactive prompt where Python code is typed and run live" },
  { term:"Python Virtual Machine (PVM)",   def:"The engine that interprets and executes Python byte code" },
  { term:"Random Access Memory (RAM)",     def:"Temporary memory that loses all data when powered off" },
  { term:"Run-Time System",                def:"The software environment active while a program executes" },
  { term:"Secondary Memory",               def:"Permanent storage that retains data even without power" },
  { term:"Semiconductor Storage Media",    def:"Storage devices made from semiconductor chip materials" },
  { term:"Server",                          def:"A computer that stores data and provides services to clients" },
  { term:"Server Farms",                   def:"Large groups of servers housed together to process requests" },
  { term:"Shell",                           def:"A command-line interface for interacting with an operating system" },
  { term:"Software",                        def:"All programs, data, and instructions that run on hardware" },
  { term:"Software Engineering",           def:"The systematic process of designing and building software" },
  { term:"Solid-State Device",             def:"A storage device with no moving parts, using electronic chips" },
  { term:"Source Code",                    def:"The original, human-readable text of a computer program" },
  { term:"String",                          def:"A sequence of characters, such as text, in a program" },
  { term:"Syntax",                          def:"The rules governing how statements in code must be structured" },
  { term:"Syntax Errors",                  def:"Mistakes that break the rules of a programming language" },
  { term:"System Software",                def:"Programs that manage and control the computer hardware itself" },
  { term:"Terminal-Based Interface",       def:"A text-only screen where users type commands directly" },
  { term:"Text Editor",                    def:"A program for writing and editing plain, unformatted text" },
  { term:"Touchscreen Interface",          def:"An input method where users interact by touching a screen" },
  { term:"Transistor",                     def:"A tiny electronic switch used to process and store data" },
  { term:"Translator",                     def:"Software that converts code between different programming forms" },
  { term:"Type Conversion Functions",      def:"Built-in functions that change data from one type to another" },
  { term:"User Interfaces",                def:"Design elements through which people interact with software" },
  { term:"Variable Identifier",            def:"A name assigned to a stored value in a program" },
  { term:"Virtual Assistant",              def:"An AI program that responds to voice or text commands" },
  { term:"Virtual Machine",                def:"Software that emulates a complete computer inside another" },
  { term:"Virtual Reality",                def:"A fully immersive computer-generated simulated environment" },
  { term:"Web Applications",               def:"Programs accessed and run inside a web browser" },
  { term:"Web Browser",                    def:"Software that lets users navigate and view websites" },
  { term:"Web Client",                     def:"A device or app that connects to and retrieves web content" },
  { term:"Web Servers",                    def:"Computers that store websites and deliver pages to browsers" },
];

const LEVELS = [
  { name:"Easy",   icon:"ğŸŒ±", pairs: 8, cols:4, cardH:152 },
  { name:"Medium", icon:"ğŸŒ¿", pairs:12, cols:6, cardH:140 },
  { name:"Hard",   icon:"ğŸ”¥", pairs:16, cols:8, cardH:128 },
];

function shuffle(a) {
  const b = [...a];
  for (let i = b.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [b[i], b[j]] = [b[j], b[i]];
  }
  return b;
}

function makeCards(n) {
  const sel = shuffle(TERMS).slice(0, n);
  return shuffle(
    sel.flatMap((t, i) => [
      { id:`t${i}`, pair:i, isTerm:true,  text:t.term },
      { id:`d${i}`, pair:i, isTerm:false, text:t.def  },
    ])
  );
}

function fmtTime(s) {
  return `${Math.floor(s/60)}:${(s%60).toString().padStart(2,"0")}`;
}

/* â”€â”€â”€ CARD â”€â”€â”€ */
function Card({ card, visible, matched, onClick, cardH }) {
  const [hov, setHov] = useState(false);
  const len = card.text.length;
  const fs  = len > 44 ? 9 : len > 32 ? 9.5 : len > 22 ? 11 : 13;

  return (
    <div
      onClick={onClick}
      onMouseEnter={() => setHov(true)}
      onMouseLeave={() => setHov(false)}
      style={{ perspective:1000, cursor: matched?"default":"pointer", height:cardH, userSelect:"none" }}
    >
      <div style={{
        transformStyle:"preserve-3d",
        transition:"transform 0.45s cubic-bezier(.4,0,.2,1)",
        transform: visible ? "rotateY(180deg)" : (hov&&!matched) ? "rotateY(6deg)" : "rotateY(0deg)",
        width:"100%", height:"100%", position:"relative",
      }}>
        {/* BACK */}
        <div style={{
          backfaceVisibility:"hidden", position:"absolute", inset:0, borderRadius:10,
          backgroundColor:"#0b4f5c",
          backgroundImage:"radial-gradient(circle, rgba(212,168,67,0.22) 1.3px, transparent 1.3px), linear-gradient(150deg, #0b4f5c 0%, #147a8f 100%)",
          backgroundSize:"16px 16px, 100% 100%",
          border:"2px solid #d4a843",
          display:"flex", alignItems:"center", justifyContent:"center",
          boxShadow: (hov&&!matched) ? "0 6px 20px rgba(0,0,0,0.45)" : "0 3px 10px rgba(0,0,0,0.3)",
          transition:"box-shadow 0.2s",
        }}>
          <span style={{ color:"#d4a843", fontSize:28, opacity:0.75, fontWeight:800 }}>?</span>
        </div>
        {/* FRONT */}
        <div style={{
          backfaceVisibility:"hidden", position:"absolute", inset:0, borderRadius:10,
          transform:"rotateY(180deg)",
          background: matched
            ? "linear-gradient(150deg, #1a6448, #22886a)"
            : card.isTerm
              ? "linear-gradient(150deg, #122c4e, #1c3f6e)"
              : "linear-gradient(150deg, #0a4858, #0d6478)",
          border:`2px solid ${matched?"#4ade80":"#d4a843"}`,
          boxShadow: matched
            ? "0 0 14px rgba(74,222,128,0.35), 0 3px 10px rgba(0,0,0,0.3)"
            : "0 3px 10px rgba(0,0,0,0.3)",
          display:"flex", flexDirection:"column", alignItems:"center", justifyContent:"center",
          padding:"8px 7px", textAlign:"center",
        }}>
          <div style={{
            fontSize:7.5, textTransform:"uppercase", letterSpacing:2, fontWeight:700,
            color: card.isTerm ? "#d4a843" : "#e8c96b", marginBottom:5,
          }}>
            {card.isTerm ? "â–¸ Term" : "â–¸ Definition"}
          </div>
          <div style={{ color:"#fff", fontSize:fs, fontWeight:card.isTerm?700:400, lineHeight:1.35 }}>
            {card.text}
          </div>
        </div>
      </div>
    </div>
  );
}

/* â”€â”€â”€ STAT BADGE â”€â”€â”€ */
function StatBadge({ label, value, color }) {
  return (
    <span style={{ color:"#ede4cd", display:"flex", alignItems:"baseline", gap:4 }}>
      <span style={{ color, fontWeight:800, fontSize:17 }}>{value}</span>
      <span style={{ opacity:0.5, fontSize:12 }}>{label}</span>
    </span>
  );
}

/* â”€â”€â”€ APP â”€â”€â”€ */
export default function App() {
  const [screen,   setScreen]   = useState("start");
  const [level,    setLevel]    = useState(null);
  const [cards,    setCards]    = useState([]);
  const [flipped,  setFlipped]  = useState([]);
  const [matched,  setMatched]  = useState(new Set());
  const [moves,    setMoves]    = useState(0);
  const [secs,     setSecs]     = useState(0);
  const [locked,   setLocked]   = useState(false);
  const [peeking,  setPeeking]  = useState(false);
  const [peekUsed, setPeekUsed] = useState(false);

  useEffect(() => {
    if (screen !== "game") return;
    const t = setInterval(() => setSecs(s => s + 1), 1000);
    return () => clearInterval(t);
  }, [screen]);

  function startGame(lvl) {
    setLevel(lvl);
    setCards(makeCards(lvl.pairs));
    setFlipped([]);
    setMatched(new Set());
    setMoves(0); setSecs(0);
    setLocked(false);
    setPeeking(false);
    setPeekUsed(false);
    setScreen("game");
  }

  function handleClick(i) {
    if (locked || peeking) return;
    if (flipped.includes(i)) return;
    if (matched.has(cards[i].pair)) return;
    const next = [...flipped, i];
    setFlipped(next);
    if (next.length === 2) {
      setLocked(true);
      setMoves(m => m + 1);
      const [a, b] = next;
      if (cards[a].pair === cards[b].pair) {
        const nm = new Set(matched);
        nm.add(cards[a].pair);
        setMatched(nm);
        setFlipped([]);
        setLocked(false);
        if (nm.size === level.pairs) setTimeout(() => setScreen("win"), 520);
      } else {
        setTimeout(() => { setFlipped([]); setLocked(false); }, 1000);
      }
    }
  }

  function doPeek() {
    if (peekUsed || peeking) return;
    setPeekUsed(true);
    setPeeking(true);
    setTimeout(() => setPeeking(false), 3000);
  }

  function getRating() {
    const r = moves / level.pairs;
    if (r <= 1.3) return { emoji:"ğŸ†", label:"Perfect!",         color:"#ffd700" };
    if (r <= 2.2) return { emoji:"â­", label:"Excellent!",       color:"#7dd3fc" };
    if (r <= 3.8) return { emoji:"ğŸ‘", label:"Great Job!",       color:"#86efac" };
    return               { emoji:"ğŸ“š", label:"Keep Practicing!", color:"#c4b5fd" };
  }

  const shell = {
    minHeight:"100vh", background:"#0e1b35",
    fontFamily:"'Georgia', 'Times New Roman', serif",
    display:"flex", flexDirection:"column",
    alignItems:"center", justifyContent:"center", padding:32,
  };

  /* â•â• START â•â• */
  if (screen === "start") return (
    <div style={shell}>
      <div style={{ textAlign:"center", maxWidth:720 }}>
        <div style={{ fontSize:52 }}>ğŸ’»</div>
        <h1 style={{ color:"#d4a843", fontSize:38, margin:"10px 0 0", fontWeight:800, letterSpacing:-0.5 }}>
          CS Term Matcher
        </h1>
        <p style={{ color:"#ede4cd", fontSize:15, margin:"12px 0 0", opacity:0.72, lineHeight:1.6, fontFamily:"'Segoe UI', sans-serif" }}>
          Flip cards to pair each computing term with its definition.<br/>
          Test yourself across <strong style={{ color:"#d4a843" }}>90 essential CS concepts</strong>.
        </p>
        <div style={{ display:"flex", gap:18, marginTop:40, justifyContent:"center", flexWrap:"wrap" }}>
          {LEVELS.map(lvl => (
            <button key={lvl.name} onClick={() => startGame(lvl)} style={{
              background:"linear-gradient(150deg, #0b4f5c, #147a8f)",
              border:"2px solid #d4a843", borderRadius:14, color:"#fff",
              padding:"20px 30px", cursor:"pointer", textAlign:"center",
              boxShadow:"0 4px 14px rgba(0,0,0,0.35)",
              transition:"transform 0.15s, box-shadow 0.15s", outline:"none",
            }}
              onMouseEnter={e=>{ e.currentTarget.style.transform="scale(1.07)"; e.currentTarget.style.boxShadow="0 6px 24px rgba(0,0,0,0.5)"; }}
              onMouseLeave={e=>{ e.currentTarget.style.transform="scale(1)";   e.currentTarget.style.boxShadow="0 4px 14px rgba(0,0,0,0.35)"; }}
            >
              <div style={{ fontSize:22 }}>{lvl.icon}</div>
              <div style={{ color:"#d4a843", fontSize:19, fontWeight:700, marginTop:3 }}>{lvl.name}</div>
              <div style={{ fontSize:13, opacity:0.7, marginTop:3, fontFamily:"'Segoe UI', sans-serif" }}>{lvl.pairs} pairs Â· {lvl.pairs*2} cards</div>
            </button>
          ))}
        </div>
        <p style={{ color:"#ede4cd", fontSize:13, marginTop:38, opacity:0.4, lineHeight:1.7, fontFamily:"'Segoe UI', sans-serif" }}>
          90 terms drawn randomly each round Â· One free "Peek" hint per game
        </p>
      </div>
    </div>
  );

  /* â•â• WIN â•â• */
  if (screen === "win") {
    const { emoji, label, color } = getRating();
    return (
      <div style={shell}>
        <div style={{ textAlign:"center" }}>
          <div style={{ fontSize:80 }}>ğŸ‰</div>
          <h1 style={{ color:"#d4a843", fontSize:44, margin:"16px 0 6px", fontWeight:800 }}>You Won!</h1>
          <div style={{ color, fontSize:24, fontWeight:700, fontFamily:"'Segoe UI', sans-serif" }}>{emoji} {label}</div>
          <div style={{ display:"flex", gap:52, justifyContent:"center", marginTop:30 }}>
            {[["Moves", moves],["Time", fmtTime(secs)]].map(([lbl, val]) => (
              <div key={lbl}>
                <div style={{ color:"#d4a843", fontSize:42, fontWeight:800 }}>{val}</div>
                <div style={{ color:"#ede4cd", fontSize:14, opacity:0.6, fontFamily:"'Segoe UI', sans-serif" }}>{lbl}</div>
              </div>
            ))}
          </div>
          <div style={{ display:"flex", gap:14, marginTop:36, justifyContent:"center" }}>
            <button onClick={() => startGame(level)} style={{ background:"linear-gradient(150deg,#0b4f5c,#147a8f)", border:"2px solid #d4a843", borderRadius:10, color:"#fff", padding:"13px 30px", cursor:"pointer", fontSize:17, fontWeight:700, outline:"none", fontFamily:"'Segoe UI', sans-serif" }}>
              ğŸ”„ Play Again
            </button>
            <button onClick={() => setScreen("start")} style={{ background:"transparent", border:"2px solid #d4a843", borderRadius:10, color:"#d4a843", padding:"13px 30px", cursor:"pointer", fontSize:17, outline:"none", fontFamily:"'Segoe UI', sans-serif" }}>
              Menu
            </button>
          </div>
        </div>
      </div>
    );
  }

  /* â•â• GAME â•â• */
  return (
    <div style={{ minHeight:"100vh", background:"#0e1b35", fontFamily:"'Segoe UI', system-ui, sans-serif", padding:"16px 18px 30px" }}>
      {/* header */}
      <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", maxWidth:940, margin:"0 auto 10px", flexWrap:"wrap", gap:10 }}>
        <div style={{ display:"flex", gap:20 }}>
          <StatBadge label="Moves"   value={moves}                         color="#d4a843" />
          <StatBadge label="Time"    value={fmtTime(secs)}                color="#d4a843" />
          <StatBadge label="Matched" value={`${matched.size}/${level.pairs}`} color="#4ade80" />
        </div>
        <div style={{ display:"flex", gap:8 }}>
          {!peekUsed && (
            <button onClick={doPeek} disabled={peeking} style={{
              background: peeking ? "rgba(74,222,128,0.15)" : "rgba(212,168,67,0.12)",
              border:`1px solid ${peeking?"#4ade80":"#d4a843"}`,
              borderRadius:8, color: peeking?"#4ade80":"#d4a843",
              padding:"7px 14px", cursor: peeking?"default":"pointer",
              fontSize:13, fontWeight:600, outline:"none",
            }}>
              {peeking ? "ğŸ‘ Peekingâ€¦" : "ğŸ‘ Peek"}
            </button>
          )}
          <button onClick={() => startGame(level)} style={{ background:"linear-gradient(150deg,#0b4f5c,#147a8f)", border:"1px solid #d4a843", borderRadius:8, color:"#fff", padding:"7px 16px", cursor:"pointer", fontSize:13, fontWeight:600, outline:"none" }}>ğŸ”„ New</button>
          <button onClick={() => setScreen("start")} style={{ background:"transparent", border:"1px solid rgba(212,168,67,0.4)", borderRadius:8, color:"#d4a843", padding:"7px 16px", cursor:"pointer", fontSize:13, outline:"none" }}>Menu</button>
        </div>
      </div>
      {/* progress bar */}
      <div style={{ maxWidth:940, margin:"0 auto 14px", height:5, background:"#1e3555", borderRadius:3, overflow:"hidden" }}>
        <div style={{ height:"100%", width:`${(matched.size/level.pairs)*100}%`, background:"linear-gradient(90deg, #147a8f, #4ade80)", transition:"width 0.4s ease", borderRadius:3 }} />
      </div>
      {/* grid */}
      <div style={{ display:"grid", gridTemplateColumns:`repeat(${level.cols}, 1fr)`, gap:10, maxWidth:940, margin:"0 auto" }}>
        {cards.map((card, i) => (
          <Card
            key={card.id}
            card={card}
            visible={flipped.includes(i) || matched.has(card.pair) || peeking}
            matched={matched.has(card.pair)}
            onClick={() => handleClick(i)}
            cardH={level.cardH}
          />
        ))}
      </div>
    </div>
  );
}
